package test

import (
	"strings"
	"testing"

	"github.com/tmck-code/go-ansi-convert/src/convert"
)

// Test ANSI line reversal -----------------------------------------------------
//
// These are smaller "unit" tests for ANSI line reversal.
// - reverse individual lines
// - reverse multiple (newline separated) lines

func TestFlipUnicodeHorizontal(test *testing.T) {
	testCases := []struct {
		name     string
		input    []string
		expected []string
	}{
		{
			name:     "ASCII lowercase horizontal flip",
			input:    []string{"abcdefghijklmnopqrstuvwxyz"},
			expected: []string{"zÎ³xwvuÉŸÆ¨É¿pqonmlÊá’‘iâ‘Ï±êŸ»É˜bÉ”dÉ’"},
		},
		{
			name:     "ASCII uppercase horizontal flip",
			input:    []string{"ABCDEFGHIJKLMNOPQRSTUVWXYZ"},
			expected: []string{"ZYXWVUTÆ§Ğ¯Ï˜á‘«OĞ˜Mâ…ƒê“˜á’IHGêŸ»Æá—¡Æ†á—ºA"},
		},
		{
			name:     "Unicode horizontal flip",
			input:    []string{"â–ˆâ–€â–€â–€â–â–„â–"},
			expected: []string{"â–Œâ–„â–Œâ–€â–€â–€â–ˆ"},
		},
		{
			name:     "Unicode horizontal flip 2",
			input:    []string{"â–ğŸ­»ğŸ­ºğŸ­¹ğŸ­¸ğŸ­·ğŸ­¶â–”|ğŸ¬ğŸ¬â–—â––â–â–˜ğŸ¯¤â–˜"},
			expected: []string{"â–ğŸ¯¤â–â–˜â–—â––ğŸ¬ğŸ¬|â–”ğŸ­¶ğŸ­·ğŸ­¸ğŸ­¹ğŸ­ºğŸ­»â–"},
		},
		{
			name: "Unicode multi-line horizontal flip",
			input: []string{
				"â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œâ–€â–€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ", // â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–€â–€â–â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
				"â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–€ â–€â–€â–â–„ â–â–ˆâ–ˆâ–ˆâ–ˆ", // â–ˆâ–ˆâ–ˆâ–ˆâ–Œ â–„â–Œâ–€â–€ â–€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
				"â–ˆâ–ˆâ–ˆâ–ˆâ–Œâ–€â–€â–â–ˆâ–Œâ–„â–Œ â–‘â–“â–“ â–“â–“â–“ â–ˆâ–ˆâ–ˆâ–ˆ", // â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“ â–“â–“â–‘ â–â–„â–â–ˆâ–Œâ–€â–€â–â–ˆâ–ˆâ–ˆâ–ˆ
				"â–ˆâ–ˆâ–Œâ–€â–€â–€â–€â–€â–€â–Œâ–ˆâ–Œ â– â–€â–„â–“â–â–„â–€â–€â–ˆâ–ˆâ–ˆ", // â–ˆâ–ˆâ–ˆâ–€â–€â–„â–Œâ–“â–„â–€ â–Œ â–â–ˆâ–â–€â–€â–€â–€â–€â–€â–â–ˆâ–ˆ
			},
			expected: []string{
				"â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–€â–€â–â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ",
				"â–ˆâ–ˆâ–ˆâ–ˆâ–Œ â–„â–Œâ–€â–€ â–€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ",
				"â–ˆâ–ˆâ–ˆâ–ˆ â–“â–“â–“ â–“â–“â–‘ â–â–„â–â–ˆâ–Œâ–€â–€â–â–ˆâ–ˆâ–ˆâ–ˆ",
				"â–ˆâ–ˆâ–ˆâ–€â–€â–„â–Œâ–“â–„â–€ â–Œ â–â–ˆâ–â–€â–€â–€â–€â–€â–€â–â–ˆâ–ˆ",
			},
		},
		{
			name: "Text box horizontal flip",
			input: []string{
				"â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",  //  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
				"â”‚  â•”â•â•â•â•— Some Text  â”‚â–’", // â–’â”‚  ÉŸxÉ˜T É˜moÆ§ â•”â•â•â•â•—  â”‚
				"â”‚  â•šâ•â•¦â•â• in the box â”‚â–’", // â–’â”‚ xod É˜â‘ÉŸ ni â•šâ•â•¦â•â•  â”‚
				"â•â•â•¤â•â•â•©â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•¡â–’", // â–’â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•©â•â•â•¤â•â•¡
				"â”‚ â”œâ”€â”€â”¬â”€â”€â”¤           â”‚â–’", // â–’â”‚           â”œâ”€â”€â”¬â”€â”€â”¤ â”‚
				"â”‚ â””â”€â”€â”´â”€â”€â”˜           â”‚â–’", // â–’â”‚           â””â”€â”€â”´â”€â”€â”˜ â”‚
				"â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â–’", // â–’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
				"â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’",  //  â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
			},
			expected: []string{
				" â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
				"â–’â”‚  ÉŸxÉ˜T É˜moÆ§ â•”â•â•â•â•—  â”‚",
				"â–’â”‚ xod É˜â‘ÉŸ ni â•šâ•â•¦â•â•  â”‚",
				"â–’â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•©â•â•â•¤â•â•¡",
				"â–’â”‚           â”œâ”€â”€â”¬â”€â”€â”¤ â”‚",
				"â–’â”‚           â””â”€â”€â”´â”€â”€â”˜ â”‚",
				"â–’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
				" â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’",
			},
		},
		{
			name: "LDA-FALL art vertical flip",
			input: []string{
				"     â– â–„â–“â–„   â–„â–Œ    â–„   â–„â–„â– â–ˆâ–€â–€â–„â–‘â–‘â–„ â–ˆâ–ˆâ–ˆâ– â–€â–ˆâ–ˆâ–‘ â–ˆâ–“",   // "  â–“â–ˆ â–‘â–ˆâ–ˆâ–€â– â–ˆâ–ˆâ–ˆ â–„â–‘â–‘â–„â–€â–€â–ˆâ– â–„â–„   â–„    â–â–„   â–„â–“â–„â–      "
				"      â–€â–ˆâ–ˆâ–“â–â–“â–„â–Œ   â–â–‘ â– â–“â–ˆâ–ˆâ– â–„â–„â– â– â–€â–€â–‘â–‘â–„â–„â–ˆâ–ˆâ–ˆâ–‘â–‘  â–ˆâ–€â– ",  // " â– â–€â–ˆ  â–‘â–‘â–ˆâ–ˆâ–ˆâ–„â–„â–‘â–‘â–€â–€â– â– â–„â–„â– â–ˆâ–ˆâ–“â–  â–‘â–Œ   â–â–„â–“â–Œâ–“â–ˆâ–ˆâ–€      "
				"     â– â–€â–€â–„â–’â–€â–€â–€â–„â–„â–„ â–€â–’â–Œâ–„â–„ â–€â–€ â–„â–€â–‘â–€â–„â– â–„â–„â–ˆâ–ˆâ–€â–‘â–â–Œ   â–Œ",   // "  â–   â–â–Œâ–‘â–€â–ˆâ–ˆâ–„â–„â– â–„â–€â–‘â–€â–„ â–€â–€ â–„â–„â–â–’â–€ â–„â–„â–„â–€â–€â–€â–’â–„â–€â–€â–      "
				"      â–„â–‘â–‘â–€â–Œ   â–„â– â–€â–€â–€â–„â–„â–ˆâ– â–„  â–€â–€â–„â–ˆâ–€â–ˆâ–ˆâ–€â–€â–„â–’â–’â–ˆâ– â–ˆâ–ˆâ–„",    // "   â–„â–ˆâ–ˆâ– â–ˆâ–’â–’â–„â–€â–€â–ˆâ–ˆâ–€â–ˆâ–„â–€â–€  â–„â– â–ˆâ–„â–„â–€â–€â–€â– â–„   â–â–€â–‘â–‘â–„      "
				"                    â–„â–„â–€â–€â–€â–€â–€â–„â–„â–ˆâ–ˆâ–€â–€â– â–â–“â–“â–„â–ˆâ–ˆ â–€â–€â– ",   // "  â– â–€â–€ â–ˆâ–ˆâ–„â–“â–“â–Œâ– â–€â–€â–ˆâ–ˆâ–„â–„â–€â–€â–€â–€â–€â–„â–„                    "
				"          â–„â–Œâ–„â–     â–€â–€ â–„â–ˆâ–ˆâ–  â–„â–ˆâ–„â–ˆâ–€â–ˆâ–ˆâ–„â–€â–€  â–â–Œâ–€â–„",     // "    â–„â–€â–â–Œ  â–€â–€â–„â–ˆâ–ˆâ–€â–ˆâ–„â–ˆâ–„ â– â–ˆâ–ˆâ–„ â–€â–€    â– â–„â–â–„          "
				"     â–„â–    â–â–ˆâ–Œâ–„â– â–„â–„    â–€â–“â–€ â–ˆ â–‘â–ˆâ–â–“â–“â–„â–„     â–ˆâ–„â–Œâ–ˆâ–ˆâ–„â–„", // "â–„â–„â–ˆâ–ˆâ–â–„â–ˆ     â–„â–„â–“â–“â–Œâ–ˆâ–‘ â–ˆ â–€â–“â–€    â–„â–„â– â–„â–â–ˆâ–Œ   â– â–„     "
				"    â–’â–“â–€â– â–„ â–„ â–ˆâ–„â–ˆâ–ˆâ–€â–„        â–ˆâ–ˆâ–Œâ–€â–ˆâ–„â–„â–„â–      â–€â–„â–â–€â–“",  // " â–“â–€â–Œâ–„â–€     â– â–„â–„â–„â–ˆâ–€â–â–ˆâ–ˆ        â–„â–€â–ˆâ–ˆâ–„â–ˆ â–„ â–„â– â–€â–“â–’    "
				"  â– â–„â–€â–ˆâ–ˆâ–„â–Œâ–“â–„â–Œâ– â–€â–ˆâ–â–ˆâ–Œ â– â–„â–„â–„â–„â–ˆâ–ˆâ–ˆâ–ˆâ–“ â–„â–‘â–         â–â–Œ",    // "   â–â–Œ        â– â–‘â–„ â–“â–ˆâ–ˆâ–ˆâ–ˆâ–„â–„â–„â–„â–  â–â–ˆâ–Œâ–ˆâ–€â– â–â–„â–“â–â–„â–ˆâ–ˆâ–€â–„â–   "
				"    â–„â–€â–„â–ˆâ–„â–ˆâ–ˆâ–„â–‘ â–â–ˆâ–„â–„â–ˆâ–ˆâ–€â–€â–€  â–â–ˆâ–Œâ–‘â–“â–‘â–€â–„â–„      â–„â–ˆâ–Œ",    // "   â–â–ˆâ–„      â–„â–„â–€â–‘â–“â–‘â–â–ˆâ–Œ  â–€â–€â–€â–ˆâ–ˆâ–„â–„â–ˆâ–Œ â–‘â–„â–ˆâ–ˆâ–„â–ˆâ–„â–€â–„    "
				"     â–“â–ˆâ–€â–€â–€â–ˆâ–’â–€â–ˆâ–ˆâ–€â–€       â–„â–ˆâ–ˆ â–â–Œâ–€â–ˆâ–€â–€â–€_   â–â–ˆâ–Œ",     // "    â–â–ˆâ–Œ   _â–€â–€â–€â–ˆâ–€â–â–Œ â–ˆâ–ˆâ–„       â–€â–€â–ˆâ–ˆâ–€â–’â–ˆâ–€â–€â–€â–ˆâ–“     "
				"    â–â–€â–â–Œâ–ˆâ–„â–  â– â–€         â–â–ˆ,â–Œ â–â–€â–ˆâ–„â–„â–„â–€     â– ",      // "     â–      â–€â–„â–„â–„â–ˆâ–€â–Œ â–,â–ˆâ–Œ         â–€â–  â– â–„â–ˆâ–â–Œâ–€â–Œ    "
				"    â–¬â– â–€         â–„ â–„    â–â–ˆâ–â–ˆâ–Œâ–â–‘â–‘â–€â– â–€â–“â–“â–“â–„",         // "        â–„â–“â–“â–“â–€â– â–€â–‘â–‘â–Œâ–â–ˆâ–Œâ–ˆâ–Œ    â–„ â–„         â–€â– â–¬    "
				"            â–Œâ–„ â–â–ˆâ–ˆâ–“â–‘â–„  â–ˆâ–Œâ–ˆâ– â–€â–„â–„â– â–€â–    â–€â–€â– ",        // "       â– â–€â–€   â– â–€â– â–„â–„â–€â– â–ˆâ–â–ˆ  â–„â–‘â–“â–ˆâ–ˆâ–Œ â–„â–            "
				"    â– â–ˆâ–ˆâ–„  â–„â– â–‘â–‘â–ˆâ–€â–ˆâ–€â–€â–ˆâ–Œâ–„â–ˆâ–€ â–â–Œâ–“â–ˆ  â–„â–ˆâ–ˆâ–„",            // "           â–„â–ˆâ–ˆâ–„  â–ˆâ–“â–â–Œ â–€â–ˆâ–„â–â–ˆâ–€â–€â–ˆâ–€â–ˆâ–‘â–‘â– â–„  â–„â–ˆâ–ˆâ–     "
				"     â–„ â–€â–„â–ˆâ–‘â–â–“â–€â–ˆâ–€â–„â–‘ â–„â–ˆâ–€    â– â–ˆâ–â–Œâ–ˆâ–€â–€",              // "             â–€â–€â–ˆâ–â–Œâ–ˆâ–     â–€â–ˆâ–„ â–‘â–„â–€â–ˆâ–€â–“â–Œâ–‘â–ˆâ–„â–€ â–„     "
				"    â– â–„â–„â–ˆâ–“â–€â–„â–„â–„â–ˆâ–€â–„â–„â–ˆâ–„â–‘â–Œâ–‘â–„â–„     â–",                 // "                â–Œ     â–„â–„â–‘â–â–‘â–„â–ˆâ–„â–„â–€â–ˆâ–„â–„â–„â–€â–“â–ˆâ–„â–„â–     "
				"    _â–„â–ˆâ–„â– â–ˆâ–€â– â–€â–ˆâ–ˆâ–ˆâ–€â–â–â–“â–ˆ â–€â–“â–‘    â–€â–“",                // "               â–“â–€    â–‘â–“â–€ â–ˆâ–“â–Œâ–Œâ–€â–ˆâ–ˆâ–ˆâ–€â– â–€â–ˆâ– â–„â–ˆâ–„_    "
				"   â– â–€ â–€â–€â–‘  â–â–ˆâ–„â– â–„â–„â–ˆ â–€â–â–Œ         â–Œ",               // "              â–         â–â–Œâ–€ â–ˆâ–„â–„â– â–„â–ˆâ–Œ  â–‘â–€â–€ â–€â–    "
				"               â–„â–ˆâ–Œâ–„â–Œâ–â–“",                         // "                        â–“â–Œâ–â–„â–â–ˆâ–„               "
				"          â–„â–„â–„â–ˆâ–€â–€  â–€â–“â–„â–ˆ",                         // "                        â–ˆâ–„â–“â–€  â–€â–€â–ˆâ–„â–„â–„          "
				"        â–„â–€â–€ â– â–€    â–„â–€ â–ˆâ–€â– â–„â– ",                     // "                    â– â–„â– â–€â–ˆ â–€â–„    â–€â–  â–€â–€â–„        "
				"       â–€         â–   â–â–„",  // "                       â–„â–Œ   â–Œ         â–€       "
				"                       â– ", // "                      â–                        "
			},
			expected: []string{
				"  â–“â–ˆ â–‘â–ˆâ–ˆâ–€â– â–ˆâ–ˆâ–ˆ â–„â–‘â–‘â–„â–€â–€â–ˆâ– â–„â–„   â–„    â–â–„   â–„â–“â–„â–      ",
				" â– â–€â–ˆ  â–‘â–‘â–ˆâ–ˆâ–ˆâ–„â–„â–‘â–‘â–€â–€â– â– â–„â–„â– â–ˆâ–ˆâ–“â–  â–‘â–Œ   â–â–„â–“â–Œâ–“â–ˆâ–ˆâ–€      ",
				"  â–   â–â–Œâ–‘â–€â–ˆâ–ˆâ–„â–„â– â–„â–€â–‘â–€â–„ â–€â–€ â–„â–„â–â–’â–€ â–„â–„â–„â–€â–€â–€â–’â–„â–€â–€â–      ",
				"   â–„â–ˆâ–ˆâ– â–ˆâ–’â–’â–„â–€â–€â–ˆâ–ˆâ–€â–ˆâ–„â–€â–€  â–„â– â–ˆâ–„â–„â–€â–€â–€â– â–„   â–â–€â–‘â–‘â–„      ",
				"  â– â–€â–€ â–ˆâ–ˆâ–„â–“â–“â–Œâ– â–€â–€â–ˆâ–ˆâ–„â–„â–€â–€â–€â–€â–€â–„â–„                    ",
				"    â–„â–€â–â–Œ  â–€â–€â–„â–ˆâ–ˆâ–€â–ˆâ–„â–ˆâ–„ â– â–ˆâ–ˆâ–„ â–€â–€    â– â–„â–â–„          ",
				"â–„â–„â–ˆâ–ˆâ–â–„â–ˆ     â–„â–„â–“â–“â–Œâ–ˆâ–‘ â–ˆ â–€â–“â–€    â–„â–„â– â–„â–â–ˆâ–Œ   â– â–„     ",
				" â–“â–€â–Œâ–„â–€     â– â–„â–„â–„â–ˆâ–€â–â–ˆâ–ˆ        â–„â–€â–ˆâ–ˆâ–„â–ˆ â–„ â–„â– â–€â–“â–’    ",
				"   â–â–Œ        â– â–‘â–„ â–“â–ˆâ–ˆâ–ˆâ–ˆâ–„â–„â–„â–„â–  â–â–ˆâ–Œâ–ˆâ–€â– â–â–„â–“â–â–„â–ˆâ–ˆâ–€â–„â–   ",
				"   â–â–ˆâ–„      â–„â–„â–€â–‘â–“â–‘â–â–ˆâ–Œ  â–€â–€â–€â–ˆâ–ˆâ–„â–„â–ˆâ–Œ â–‘â–„â–ˆâ–ˆâ–„â–ˆâ–„â–€â–„    ",
				"    â–â–ˆâ–Œ   _â–€â–€â–€â–ˆâ–€â–â–Œ â–ˆâ–ˆâ–„       â–€â–€â–ˆâ–ˆâ–€â–’â–ˆâ–€â–€â–€â–ˆâ–“     ",
				"     â–      â–€â–„â–„â–„â–ˆâ–€â–Œ â–,â–ˆâ–Œ         â–€â–  â– â–„â–ˆâ–â–Œâ–€â–Œ    ",
				"        â–„â–“â–“â–“â–€â– â–€â–‘â–‘â–Œâ–â–ˆâ–Œâ–ˆâ–Œ    â–„ â–„         â–€â– â–¬    ",
				"       â– â–€â–€   â– â–€â– â–„â–„â–€â– â–ˆâ–â–ˆ  â–„â–‘â–“â–ˆâ–ˆâ–Œ â–„â–            ",
				"           â–„â–ˆâ–ˆâ–„  â–ˆâ–“â–â–Œ â–€â–ˆâ–„â–â–ˆâ–€â–€â–ˆâ–€â–ˆâ–‘â–‘â– â–„  â–„â–ˆâ–ˆâ–     ",
				"             â–€â–€â–ˆâ–â–Œâ–ˆâ–     â–€â–ˆâ–„ â–‘â–„â–€â–ˆâ–€â–“â–Œâ–‘â–ˆâ–„â–€ â–„     ",
				"                â–Œ     â–„â–„â–‘â–â–‘â–„â–ˆâ–„â–„â–€â–ˆâ–„â–„â–„â–€â–“â–ˆâ–„â–„â–     ",
				"               â–“â–€    â–‘â–“â–€ â–ˆâ–“â–Œâ–Œâ–€â–ˆâ–ˆâ–ˆâ–€â– â–€â–ˆâ– â–„â–ˆâ–„_    ",
				"              â–         â–â–Œâ–€ â–ˆâ–„â–„â– â–„â–ˆâ–Œ  â–‘â–€â–€ â–€â–    ",
				"                        â–“â–Œâ–â–„â–â–ˆâ–„               ",
				"                        â–ˆâ–„â–“â–€  â–€â–€â–ˆâ–„â–„â–„          ",
				"                    â– â–„â– â–€â–ˆ â–€â–„    â–€â–  â–€â–€â–„        ",
				"                       â–„â–Œ   â–Œ         â–€       ",
				"                      â–                        ",
			},
		},
	}
	for _, tc := range testCases {
		test.Run(tc.name, func(t *testing.T) {
			strInput := strings.Join(tc.input, "\n")
			input := convert.TokeniseANSIString(strInput)

			result := convert.FlipHorizontal(input)
			expected := convert.TokeniseANSIString(strings.Join(tc.expected, "\n"))

			PrintANSITestResults(strInput, expected, result, t)
			Assert(convert.BuildANSIString(expected, 0), convert.BuildANSIString(result, 0), t)
		})
	}
}
